#!/bin/bash
# Advanced Subdomain Enumeration Script (Silent Mode)
# Author:@atulxerma

set -euo pipefail

# Colors
GREEN="\033[0;32m"
YELLOW="\033[1;33m"
RED="\033[0;31m"
RESET="\033[0m"

# Banner
echo -e "
${GREEN}░██████╗██╗░░░██╗██████╗░████████╗██████╗░░█████╗░███╗░░██╗
██╔════╝██║░░░██║██╔══██╗╚══██╔══╝██╔══██╗██╔══██╗████╗░██║
╚█████╗░██║░░░██║██████╦╝░░░██║░░░██████╔╝██║░░██║██╔██╗██║
░╚═══██╗██║░░░██║██╔══██╗░░░██║░░░██╔══██╗██║░░██║██║╚████║
██████╔╝╚██████╔╝██████╦╝░░░██║░░░██║░░██║╚█████╔╝██║░╚███║
╚═════╝░░╚═════╝░╚═════╝░░░░╚═╝░░░╚═╝░░╚═╝░╚════╝░╚═╝░░╚══╝  
${RESET}
   Connect With Me: ${YELLOW}@atulxerma${RESET}
"

# Input validation
if [ -z "${1:-}" ]; then
    echo -e "${RED}[!] Usage: $0 <domain>${RESET}"
    exit 1
fi

DOMAIN=$1
OUTDIR="results/$DOMAIN"
mkdir -p "$OUTDIR"

echo -e "${YELLOW}[+] Target Domain:${RESET} $DOMAIN"
echo -e "${YELLOW}[+] Output Folder:${RESET} $OUTDIR"
sleep 1

# Tool check
check_tool() {
    if ! command -v "$1" &>/dev/null; then
        echo -e "${RED}[!] $1 is not installed. Please install it.${RESET}"
        exit 1
    fi
}
for tool in amass subfinder assetfinder httpx jq curl; do
    check_tool "$tool"
done

# Run tools silently
echo -e "${GREEN}[+] Running Subdomain Enumeration (please wait...)${RESET}"

amass enum -silent -d "$DOMAIN" -min-for-recursive 7 -passive -o "$OUTDIR/amass_passive.txt" >/dev/null 2>&1 &
amass enum -silent -d "$DOMAIN" -min-for-recursive 7 -brute   -o "$OUTDIR/amass_brute.txt"   >/dev/null 2>&1 &
subfinder -d "$DOMAIN" -silent -t 100 -o "$OUTDIR/subfinder.txt" >/dev/null 2>&1 &
echo "$DOMAIN" | assetfinder --subs-only > "$OUTDIR/assetfinder.txt" 2>/dev/null &
curl -s "https://crt.sh/?q=%25.$DOMAIN&output=json" \
  | jq -r '.[].name_value' | sed 's/\*\.//g' | sort -u > "$OUTDIR/crtsh.txt" 2>/dev/null &

wait

# Merge and deduplicate
sort -u "$OUTDIR"/*.txt > "$OUTDIR/domains.txt"

# Probe live hosts
cat "$OUTDIR/domains.txt" | httpx -silent -t 100 -o "$OUTDIR/live_hosts.txt" >/dev/null 2>&1

# Final summary
echo -e "${YELLOW}[=] Scan Finished!${RESET}"
echo -e "${GREEN}[+] Unique domains saved to:${RESET} $OUTDIR/domains.txt"
echo -e "${GREEN}[+] Live hosts saved to:${RESET} $OUTDIR/live_hosts.txt"
echo -e "${YELLOW}Total Domains Found:${RESET} $(wc -l < "$OUTDIR/domains.txt")"
echo -e "${YELLOW}Live Hosts:${RESET} $(wc -l < "$OUTDIR/live_hosts.txt")"
